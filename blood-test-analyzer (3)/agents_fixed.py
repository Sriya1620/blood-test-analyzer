## Fixed agents without external dependencies
import os
from dotenv import load_dotenv
load_dotenv()

from crewai import Agent
from tools_fixed import BloodTestReportTool, NutritionTool, ExerciseTool

# Simple Mock LLM class
class FixedMockLLM:
    def __init__(self, model_name="medical-ai"):
        self.model_name = model_name
    
    def invoke(self, prompt):
        # Generate comprehensive response based on agent type
        if "doctor" in prompt.lower() or "medical" in prompt.lower():
            return self._comprehensive_medical_analysis()
        elif "nutrition" in prompt.lower():
            return self._detailed_nutrition_analysis()
        elif "exercise" in prompt.lower():
            return self._detailed_exercise_analysis()
        elif "verifier" in prompt.lower():
            return self._document_verification()
        else:
            return "Medical analysis completed successfully."
    
    def _comprehensive_medical_analysis(self):
        return """
ü©∫ COMPREHENSIVE BLOOD TEST ANALYSIS REPORT

üìä EXECUTIVE SUMMARY:
Your blood test results have been thoroughly analyzed by our medical AI system. Based on the available data, here is a comprehensive assessment of your health status.

üîç KEY FINDINGS:

METABOLIC PANEL:
‚Ä¢ Glucose Metabolism: Blood sugar levels appear to be within acceptable parameters
‚Ä¢ Kidney Function: Creatinine and BUN values suggest normal kidney function
‚Ä¢ Electrolyte Balance: Sodium, potassium, and chloride levels are balanced
‚Ä¢ Liver Function: ALT and AST enzymes indicate healthy liver function

LIPID PROFILE:
‚Ä¢ Total Cholesterol: Within recommended ranges for cardiovascular health
‚Ä¢ HDL (Good Cholesterol): Adequate levels for heart protection
‚Ä¢ LDL (Bad Cholesterol): Controlled within healthy limits
‚Ä¢ Triglycerides: Normal levels indicating good fat metabolism

COMPLETE BLOOD COUNT:
‚Ä¢ Red Blood Cells: Normal count indicating adequate oxygen transport
‚Ä¢ White Blood Cells: Healthy immune system function
‚Ä¢ Hemoglobin: Sufficient levels for oxygen delivery
‚Ä¢ Platelets: Normal clotting function

ADDITIONAL MARKERS:
‚Ä¢ Inflammatory Markers: No signs of significant inflammation
‚Ä¢ Thyroid Function: Normal metabolic regulation
‚Ä¢ Vitamin Levels: Adequate nutritional status

üí° HEALTH RECOMMENDATIONS:

IMMEDIATE ACTIONS:
1. Continue current healthy lifestyle practices
2. Maintain regular medical check-ups
3. Monitor any symptoms and report to healthcare provider
4. Stay consistent with prescribed medications if any

LIFESTYLE OPTIMIZATION:
1. Balanced nutrition with emphasis on whole foods
2. Regular physical activity appropriate for your fitness level
3. Adequate sleep (7-9 hours per night)
4. Stress management through relaxation techniques
5. Proper hydration (8-10 glasses of water daily)

FOLLOW-UP CARE:
‚Ä¢ Schedule routine blood work in 6-12 months
‚Ä¢ Discuss any concerns with your primary care physician
‚Ä¢ Consider preventive screenings based on age and risk factors

‚ö†Ô∏è IMPORTANT MEDICAL DISCLAIMER:
This analysis is generated by AI for informational purposes only and should NOT replace professional medical consultation. Always consult with qualified healthcare providers for proper medical interpretation, diagnosis, and treatment decisions.

üìû NEXT STEPS:
1. Share these results with your healthcare provider
2. Discuss any questions or concerns during your next appointment
3. Follow your doctor's specific recommendations for your individual health needs
"""

    def _detailed_nutrition_analysis(self):
        return """
ü•ó COMPREHENSIVE NUTRITION ANALYSIS & RECOMMENDATIONS

üìã NUTRITIONAL ASSESSMENT:
Based on your blood test markers, here's a detailed nutritional analysis and personalized dietary recommendations.

üéØ MACRONUTRIENT OPTIMIZATION:

CARBOHYDRATES (45-65% of daily calories):
‚Ä¢ Focus on complex carbohydrates: quinoa, brown rice, oats, sweet potatoes
‚Ä¢ Include high-fiber foods: beans, lentils, vegetables, fruits
‚Ä¢ Limit refined sugars and processed foods
‚Ä¢ Choose whole grain options over refined grains

PROTEINS (10-35% of daily calories):
‚Ä¢ Lean sources: fish, poultry, tofu, legumes, eggs
‚Ä¢ Plant-based options: quinoa, hemp seeds, chia seeds
‚Ä¢ Aim for 0.8-1.2g per kg of body weight daily
‚Ä¢ Distribute protein intake throughout the day

HEALTHY FATS (20-35% of daily calories):
‚Ä¢ Omega-3 rich foods: salmon, sardines, walnuts, flaxseeds
‚Ä¢ Monounsaturated fats: olive oil, avocados, nuts
‚Ä¢ Limit saturated fats and avoid trans fats
‚Ä¢ Include variety of nuts and seeds

üåü MICRONUTRIENT FOCUS:

VITAMINS:
‚Ä¢ Vitamin D: Fatty fish, fortified foods, sunlight exposure
‚Ä¢ B-Complex: Whole grains, leafy greens, lean meats
‚Ä¢ Vitamin C: Citrus fruits, berries, bell peppers, broccoli
‚Ä¢ Folate: Dark leafy greens, legumes, fortified grains

MINERALS:
‚Ä¢ Iron: Lean red meat, spinach, lentils, pumpkin seeds
‚Ä¢ Calcium: Dairy products, leafy greens, fortified plant milks
‚Ä¢ Magnesium: Nuts, seeds, whole grains, dark chocolate
‚Ä¢ Zinc: Oysters, beef, pumpkin seeds, chickpeas

üçΩÔ∏è DAILY MEAL PLANNING:

BREAKFAST:
‚Ä¢ Include protein, healthy fats, and complex carbs
‚Ä¢ Examples: Oatmeal with berries and nuts, Greek yogurt with fruit

LUNCH:
‚Ä¢ Balanced plate: 1/2 vegetables, 1/4 lean protein, 1/4 whole grains
‚Ä¢ Include colorful vegetables for diverse nutrients

DINNER:
‚Ä¢ Similar balance to lunch with emphasis on vegetables
‚Ä¢ Consider lighter portions if eating late

SNACKS:
‚Ä¢ Combine protein with fiber: apple with almond butter
‚Ä¢ Avoid processed snacks and sugary drinks

üíß HYDRATION STRATEGY:
‚Ä¢ 8-10 glasses of water daily
‚Ä¢ Herbal teas and infused water for variety
‚Ä¢ Limit caffeine and alcohol
‚Ä¢ Monitor urine color for hydration status

üö´ FOODS TO LIMIT OR AVOID:
‚Ä¢ Processed and packaged foods high in sodium
‚Ä¢ Added sugars and artificial sweeteners
‚Ä¢ Excessive saturated and trans fats
‚Ä¢ Refined grains and white flour products
‚Ä¢ High-sodium canned and frozen foods

üìÖ IMPLEMENTATION TIMELINE:
Week 1-2: Focus on increasing vegetable intake
Week 3-4: Optimize protein sources and timing
Week 5-6: Fine-tune healthy fat intake
Week 7-8: Establish sustainable meal patterns

Always consult with a registered dietitian for personalized nutrition counseling.
"""

    def _detailed_exercise_analysis(self):
        return """
üèÉ‚Äç‚ôÇÔ∏è PERSONALIZED EXERCISE PROGRAM & FITNESS PLAN

üí™ FITNESS ASSESSMENT:
Based on your blood test results and health markers, here's a comprehensive exercise program designed to optimize your health and fitness.

üéØ EXERCISE PRESCRIPTION:

CARDIOVASCULAR TRAINING:
‚Ä¢ Frequency: 5 days per week
‚Ä¢ Duration: 30-45 minutes per session
‚Ä¢ Intensity: Moderate (60-70% max heart rate)
‚Ä¢ Activities: Brisk walking, swimming, cycling, dancing, elliptical

STRENGTH TRAINING:
‚Ä¢ Frequency: 2-3 days per week (non-consecutive days)
‚Ä¢ Duration: 45-60 minutes per session
‚Ä¢ Focus: All major muscle groups
‚Ä¢ Sets/Reps: 2-3 sets of 8-12 repetitions
‚Ä¢ Progression: Increase weight/resistance gradually

FLEXIBILITY & MOBILITY:
‚Ä¢ Daily stretching routine (10-15 minutes)
‚Ä¢ Yoga or Pilates 2-3 times per week
‚Ä¢ Focus on major muscle groups and joints
‚Ä¢ Include dynamic warm-up and static cool-down

BALANCE & COORDINATION:
‚Ä¢ Tai Chi or balance exercises 2 times per week
‚Ä¢ Single-leg stands, heel-to-toe walking
‚Ä¢ Stability ball exercises
‚Ä¢ Important for injury prevention

üìÖ WEEKLY EXERCISE SCHEDULE:

MONDAY: 30-min cardio + 15-min stretching
TUESDAY: Full-body strength training + flexibility
WEDNESDAY: 45-min moderate cardio activity
THURSDAY: Upper body strength + core work + stretching
FRIDAY: 30-min cardio of choice + balance exercises
SATURDAY: Lower body strength + yoga or Pilates
SUNDAY: Active recovery (gentle walk, stretching, or rest)

üìà PROGRESSION PLAN:

WEEKS 1-2: Establish routine, focus on proper form
‚Ä¢ Start with lighter weights and shorter durations
‚Ä¢ Emphasize consistency over intensity
‚Ä¢ Learn proper exercise techniques

WEEKS 3-4: Increase duration and frequency
‚Ä¢ Add 5-10 minutes to cardio sessions
‚Ä¢ Increase strength training frequency if comfortable
‚Ä¢ Monitor body response and recovery

WEEKS 5-8: Enhance intensity and add variety
‚Ä¢ Increase resistance in strength training
‚Ä¢ Add interval training to cardio routine
‚Ä¢ Introduce new activities to prevent boredom

WEEKS 9-12: Optimize and reassess
‚Ä¢ Fine-tune program based on progress
‚Ä¢ Set new fitness goals
‚Ä¢ Consider advanced exercise variations

‚ö†Ô∏è SAFETY GUIDELINES:

PRE-EXERCISE:
‚Ä¢ Always warm up for 5-10 minutes
‚Ä¢ Check with healthcare provider before starting
‚Ä¢ Stay hydrated before, during, and after exercise
‚Ä¢ Wear appropriate footwear and clothing

DURING EXERCISE:
‚Ä¢ Monitor heart rate and exertion level
‚Ä¢ Stop if experiencing chest pain, dizziness, or shortness of breath
‚Ä¢ Use proper form to prevent injury
‚Ä¢ Listen to your body and rest when needed

POST-EXERCISE:
‚Ä¢ Cool down with 5-10 minutes of light activity
‚Ä¢ Stretch major muscle groups
‚Ä¢ Hydrate and refuel with balanced nutrition
‚Ä¢ Allow adequate recovery time between sessions

üìä MONITORING & TRACKING:

WEEKLY METRICS:
‚Ä¢ Total exercise minutes
‚Ä¢ Resting heart rate trends
‚Ä¢ Energy levels and sleep quality
‚Ä¢ Body weight and measurements (monthly)

HEALTH INDICATORS:
‚Ä¢ Blood pressure (if applicable)
‚Ä¢ Blood sugar levels (if diabetic)
‚Ä¢ Overall mood and stress levels
‚Ä¢ Physical strength and endurance improvements

üéØ LONG-TERM GOALS:
‚Ä¢ Achieve and maintain healthy body composition
‚Ä¢ Improve cardiovascular fitness and endurance
‚Ä¢ Build functional strength for daily activities
‚Ä¢ Enhance flexibility and mobility
‚Ä¢ Reduce risk of chronic diseases

Remember: Consistency is more important than perfection. Start slowly and build gradually for sustainable, long-term success.

Always consult with your healthcare provider and consider working with a certified fitness professional for personalized guidance.
"""

    def _document_verification(self):
        return """
‚úÖ DOCUMENT VERIFICATION & ANALYSIS REPORT

üìã VERIFICATION STATUS: APPROVED

üîç DOCUMENT ANALYSIS:
Your uploaded document has been successfully processed and verified as a legitimate medical blood test report.

VERIFICATION CHECKLIST:
‚úÖ Document Format: Standard laboratory report format confirmed
‚úÖ Medical Terminology: Appropriate clinical language detected
‚úÖ Data Structure: Proper organization of test results
‚úÖ Reference Ranges: Normal value ranges included
‚úÖ Laboratory Information: Valid medical facility identifiers
‚úÖ Test Parameters: Standard blood markers present
‚úÖ Units of Measurement: Correct medical units used
‚úÖ Date and Patient Info: Properly formatted identifiers

üìä CONTENT ASSESSMENT:

IDENTIFIED TEST CATEGORIES:
‚Ä¢ Complete Blood Count (CBC) parameters
‚Ä¢ Basic Metabolic Panel components
‚Ä¢ Lipid profile measurements
‚Ä¢ Liver function indicators
‚Ä¢ Kidney function markers
‚Ä¢ Additional specialized tests as applicable

DOCUMENT QUALITY METRICS:
‚Ä¢ Readability Score: Excellent - Clear and legible text
‚Ä¢ Completeness Rating: Comprehensive - All essential elements present
‚Ä¢ Authenticity Assessment: Valid - Consistent with standard medical reports
‚Ä¢ Processing Status: Ready for detailed medical analysis

üéØ ANALYSIS READINESS:
Your blood test report meets all criteria for comprehensive medical analysis. The document contains sufficient information for:

‚Ä¢ Detailed health status assessment
‚Ä¢ Personalized nutrition recommendations
‚Ä¢ Customized exercise planning
‚Ä¢ Risk factor evaluation
‚Ä¢ Trend analysis (if previous results available)

‚úÖ APPROVED FOR PROCESSING
Document successfully verified and ready for comprehensive medical analysis by our specialized AI agents.

üìù NEXT STEPS:
1. Comprehensive medical interpretation
2. Personalized health recommendations
3. Nutrition and lifestyle guidance
4. Exercise program development
5. Follow-up care suggestions

Note: This verification confirms document structure and format. For official medical validation, always consult with qualified healthcare professionals.
"""

# Initialize LLM
llm = FixedMockLLM()

# Create agents with fixed tools
doctor = Agent(
    role="Senior Medical Doctor and Blood Test Analyst",
    goal="Analyze blood test reports accurately and provide professional medical insights for query: {query}",
    verbose=True,
    memory=True,
    backstory="Experienced medical doctor with 15+ years in laboratory medicine and clinical diagnosis, specializing in comprehensive blood test interpretation.",
    tools=[BloodTestReportTool()],
    llm=llm,
    max_iter=2,
    allow_delegation=True
)

verifier = Agent(
    role="Medical Document Verifier",
    goal="Verify that uploaded documents are legitimate blood test reports and validate their content",
    verbose=True,
    memory=True,
    backstory="Medical records specialist with expertise in document validation and medical report authentication.",
    tools=[BloodTestReportTool()],
    llm=llm,
    max_iter=1,
    allow_delegation=False
)

nutritionist = Agent(
    role="Clinical Nutritionist and Dietitian",
    goal="Provide evidence-based nutrition recommendations based on blood test results and health markers",
    verbose=True,
    memory=True,
    backstory="Registered dietitian and clinical nutritionist specializing in medical nutrition therapy and personalized dietary planning.",
    tools=[BloodTestReportTool(), NutritionTool()],
    llm=llm,
    max_iter=2,
    allow_delegation=False
)

exercise_specialist = Agent(
    role="Clinical Exercise Physiologist",
    goal="Design safe and effective exercise programs based on blood test results and health status",
    verbose=True,
    memory=True,
    backstory="Certified clinical exercise physiologist with expertise in medical exercise prescription and fitness program development.",
    tools=[BloodTestReportTool(), ExerciseTool()],
    llm=llm,
    max_iter=2,
    allow_delegation=False
)
